{% extends "base.html" %}

{% block title %}Upload Video{% endblock %}

{% block content %}
<div class="card">
    <h2>Upload Video</h2>
    <form method="POST" enctype="multipart/form-data">
        <input id="upload-file" type="file" name="file" required><br><br>

        <label>Custom video title (optional)</label><br>
        <input id="upload-display-name" type="text" name="display_name" placeholder="Example: Introduction to Flask"><br><br>

        <label>Description (optional)</label><br>
        <textarea name="description" rows="3" placeholder="Add notes, agenda, or context for this video" style="width: 100%;"></textarea><br><br>

        <label>Playlist order (optional)</label><br>
        <input type="number" name="sort_order" min="0" placeholder="Auto"><br><br>

        <select name="collection_id" required>
            {% for c in collection_options %}
                <option value="{{c.id}}">{{c.label}}</option>
            {% endfor %}
        </select><br><br>

        <select name="visibility">
            <option value="public">Public</option>
            <option value="unlisted">Unlisted</option>
            <option value="private">Private</option>
        </select><br><br>

        <div style="margin-bottom: 14px; font-size: 14px; color: #b6aa99; line-height: 1.5;">
            <strong>Visibility guide:</strong><br>
            <strong>Public</strong>: shown in collection pages and accessible to anyone who visits the collection.<br>
            <strong>Unlisted</strong>: hidden from collection pages, but anyone with the direct video link can watch.<br>
            <strong>Private</strong>: only visible to logged-in admins.
        </div>

        <button>Upload</button>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
function attachAutoTitle(fileInputId, titleInputId) {
    const fileInput = document.getElementById(fileInputId);
    const titleInput = document.getElementById(titleInputId);
    if (!fileInput || !titleInput) return;

    fileInput.addEventListener("change", () => {
        const selectedFile = fileInput.files && fileInput.files[0];
        if (!selectedFile) return;

        const baseName = selectedFile.name.replace(/\.[^/.]+$/, "");
        const lastAuto = titleInput.dataset.lastAutoValue || "";
        const current = titleInput.value.trim();

        if (!current || current === lastAuto) {
            titleInput.value = baseName;
            titleInput.dataset.lastAutoValue = baseName;
        }
    });
}

attachAutoTitle("upload-file", "upload-display-name");
</script>
{% endblock %}
