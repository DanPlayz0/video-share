{% extends "base.html" %}

{% block title %}Analytics{% endblock %}

{% block content %}
<div class="card">
    <h1>Analytics</h1>
    <p style="color: #b6aa99;">Aggregated from in-memory buffers and flushed to SQLite in batches.</p>
</div>

<div class="card">
    <h2>Top Page Visits</h2>
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr>
                <th style="text-align: left; padding: 6px;">Path</th>
                <th style="text-align: left; padding: 6px; width: 120px;">Visits</th>
                <th style="text-align: left; padding: 6px; width: 280px;">Last Visit (UTC)</th>
            </tr>
        </thead>
        <tbody>
        {% for row in top_pages %}
            <tr>
                <td style="padding: 6px; color: #b6aa99;">{{ row.path }}</td>
                <td style="padding: 6px;">{{ row.visit_count }}</td>
                <td style="padding: 6px; color: #b6aa99;">{{ row.last_visited_at or '' }}</td>
            </tr>
        {% else %}
            <tr><td colspan="3" style="padding: 6px; color: #b6aa99;">No data yet.</td></tr>
        {% endfor %}
        </tbody>
    </table>
</div>

<div class="card">
    <h2>Top Video Views</h2>
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr>
                <th style="text-align: left; padding: 6px;">Video</th>
                <th style="text-align: left; padding: 6px; width: 120px;">Views</th>
                <th style="text-align: left; padding: 6px; width: 280px;">Last View (UTC)</th>
            </tr>
        </thead>
        <tbody>
        {% for row in top_videos %}
            <tr>
                <td style="padding: 6px;"><a href="/video/{{ row.id }}">{{ row.title }}</a></td>
                <td style="padding: 6px;">{{ row.view_count }}</td>
                <td style="padding: 6px; color: #b6aa99;">{{ row.last_viewed_at or '' }}</td>
            </tr>
        {% else %}
            <tr><td colspan="3" style="padding: 6px; color: #b6aa99;">No data yet.</td></tr>
        {% endfor %}
        </tbody>
    </table>
</div>

<div class="card">
    <h2>Most Watched Segments</h2>
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr>
                <th style="text-align: left; padding: 6px;">Video</th>
                <th style="text-align: left; padding: 6px; width: 140px;">Segment Start</th>
                <th style="text-align: left; padding: 6px; width: 160px;">Watch Seconds</th>
            </tr>
        </thead>
        <tbody>
        {% for row in top_segments %}
            <tr>
                <td style="padding: 6px;"><a href="/video/{{ row.id }}">{{ row.title }}</a></td>
                <td style="padding: 6px; color: #b6aa99;">{{ row.bucket_start_sec }}s</td>
                <td style="padding: 6px;">{{ '%.1f'|format(row.watch_seconds) }}</td>
            </tr>
        {% else %}
            <tr><td colspan="3" style="padding: 6px; color: #b6aa99;">No data yet.</td></tr>
        {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
